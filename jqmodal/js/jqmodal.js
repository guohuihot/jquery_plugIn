/**
* author : ahuing
* date   : 2015-04-10
* name   : jqModal v1.0
* modify : 2015-7-9 16:38:04
 */
!function(a){function b(){var c,a=document.createElement("div"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}function f(b){return this.each(function(){var c=a(this),d=c.data("jqDrag"),f=a.extend({},e.defaults,c.data(),"object"==typeof b&&b);d||(c.data("jqDrag",d=new e(this,f)),d.init()),"string"==typeof b&&d[b]()})}function h(b,c){return this.each(function(){var d=a(this),e=d.data("jqModal"),f=a.extend({},g.defaults,d.data(),"object"==typeof b&&b);e?"string"==typeof b?e[b](c):e["toggle"]():(d.data("jqModal",e=new g(this,f)),e.show())})}var c,d,e,g,i;a.fn.emulateTransitionEnd=function(b){var e,c=!1,d=this;return a(this).one("bsTransitionEnd",function(){c=!0}),e=function(){c||a(d).trigger(a.support.transition.end)},setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})}),c=!-[1]&&!window.XMLHttpRequest,d=function(b,c,d){var e=a(d?c||window:"body"),f=a(window).scrollTop(),g=b.outerWidth(),h=b.outerHeight(),i=e.width(),j=e.height();return{minL:g>i?i-g:0,minT:h>j?j-h:0,maxL:g>i?0:e.width()-g,maxT:h>j?0:e.height()-h,st:f,h:h}},e=function(b,c){this.o=a.extend({},e.defaults,c),this.$self=a(b),this.$handle=this.o.handle&&this.$self.find(this.o.handle)||this.$self},e.defaults={handle:"",fixed:1,opacity:1,attachment:""},e.prototype.init=function(){var b=this.o,e=this.$self.css("animation-fill-mode","backwards"),f=this.$handle;f.css({cursor:"move"}).on("selectstart",function(){return!1}).on("mousedown",function(f){e.css({opacity:b.opacity,zIndex:parseInt((new Date).getTime()/1e3)}).trigger("dragEnd",[g]);var g=d(e,b.attachment,b.fixed),h=e.position(),i=h.left-f.pageX,j=h.top-f.pageY;return a(document).on("mousemove",function(a){a.preventDefault();var d=i+a.pageX,f=j+a.pageY,h=f<g.minT?g.minT:f>g.maxT?g.maxT:f;c&&b.fixed&&(h=f<g.st?g.st:f-g.st>s.maxT?g.maxT+g.st:f),e.css({left:d<g.minL?g.minL:d>g.maxL?g.maxL:d,top:h}).trigger("drag",[g])}).on("mouseup",function(){a(this).off("mousemove"),e.css("opacity",1).trigger("dragEnd",[g])}),!1})},a.fn.jqDrag=f,g=function(b,c){this.o=c,this.Z=parseInt((new Date).getTime()/1e3),this.$self=a(b),this.isShown=!1,this.init()},g.prototype={init:function(){var e,f,g,b=this.o,d='<div class="jqModal animated">    <div class="m-content m-'+b.mclass+'">'+'        <div class="m-head">'+b.head+"</div>"+'        <div class="m-body"></div>'+'        <div class="m-foot">'+b.foot+"</div>"+'        <a class="m-close" data-close="1" title="关闭" href="#"></a>'+"    </div>"+"</div>";this.$box=a(d).appendTo("body").css(a.extend({},b.css,{zIndex:this.Z,position:b.fixed&&!c&&"fixed"||"absolute"})),this.$hd=this.$box.find(".m-head").css(a.extend({},b.headcss,!b.head&&{display:"none"})),this.$bd=this.$box.find(".m-body").css(b.bodycss),this.$ft=this.$box.find(".m-foot").css(a.extend({},b.footcss,!b.foot&&{display:"none"})),this.$box.on("click","[data-close]",a.proxy(this.hide,this)),b.overlay&&(this.$overlay=a('<div class="m-overlay"></div>').insertBefore(this.$box).css({opacity:b.overlay,zIndex:this.Z}).on("click",!b.lock&&a.proxy(this.hide,this)||a.noop)),c&&a("select").css("visibility","hidden"),this.$loading=a(".modal-loading")||a('<div class="modal-loading"></div>').appendTo("body"),e=b.target,this.$self.is("iframe")?this.$self.attr({scrolling:"no",allowtransparency:!0,frameborder:0,src:b.remote}).appendTo(this.$bd).load(a.proxy(function(){this.$self.add(this.$bd).height(this.$self.css("background","none").contents().find("body").height()),this.setPos()},this)):this.$self.is("img")?(this.loading("show"),f=a("<img>"),g=new Image,g.onerror=function(){this.loading("error")},g.onload=function(){var a=this.getImgSize(g,parseInt(.8*$w.width()),parseInt(.8*$w.height()));this.$bd.html(f.css({width:a[0],height:a[1]})),this.setPos()},g.src=e,f.attr("src",e)):this.$bd.append(this.$self.css("display","block")),this.setPos(),a(document).on("keydown.modal",a.proxy(function(a){return 27==a.which&&this.hide(),!0},this)),b.fixed&&a(window).on("resize",a.proxy(this.setPos,this)),b.callBack&&b.callBack.call(this)},show:function(){var b,d;this.isShown||(this.$self.trigger("showFun"),this.$overlay&&this.$overlay.css("display","block"),this.$box.css("display","block"),a.support.transition&&this.$box.addClass(this.o.animate),this.$self.trigger("shownFun"),this.isShown=!0,c&&o.fixed&&!o.drag&&(b=s.maxT/2,d=a(window),d.on("scroll",function(){this.$box.css({top:b+d.scrollTop()})})),this.o.drag&&f.call(this.$box,{handle:this.$hd,fixed:this.o.fixed}),this.o.timeout&&(clearTimeout(this.t),this.t=setTimeout(a.proxy(this.hide,this),this.o.timeout)))},hideModal:function(){this.$box.removeClass(this.o.animate+"H").hide(),this.$overlay&&this.$overlay.hide(),this.$self.trigger("hidenFun")},hide:function(b){return this.$self.trigger("hideFun"),setTimeout(a.proxy(function(){this.$box.removeClass(this.o.animate).addClass(this.o.animate+"H"),a.support.transition&&this.$box.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(500)||this.hideModal()},this),b||0),c&&a("select").css("visibility","visible"),this.isShown=!1,!1},toggle:function(a){return this.isShown?this.hide(a):this.show()},loading:function(a){this.$loading[a]()},setPos:function(){var b=this.o,e=d(this.$box,null,b.fixed);this.$box.css({left:b.css.right>=0?"auto":b.css.left||e.maxL/2,top:b.css.bottom>=0?"auto":b.css.top||(a(window).height()-e.h)/2+((c||!b.fixed)&&e.st)})}},g.defaults={mclass:"modal",head:"",foot:"",remote:"",fixed:1,overlay:.3,drag:1,lock:0,timeout:0,css:{},headcss:{},bodycss:{},footcss:{},animate:"bounceInDown"},i=a.fn.jqModal,a.fn.jqModal=h,a.fn.jqModal.Constructor=g,a.fn.jqModal.noConflict=function(){return a.fn.jqModal=i,this},a('<link rel="stylesheet">').appendTo("head").attr("href",("undefined"!=typeof tplurl?tplurl:"")+"css/jqmodal.css"),a(document).on("click",".btn-jqModal",function(b){var e,f,g,c=a(this),d=c.data("target")||c.attr("href");"string"==typeof d?(e=0==d.indexOf("http"),f=a(e&&'<iframe class="jqiframe"/>'||d.replace(/.*(?=#[^\s]+$)/,"")),c.data("target",f),g=a.extend({remote:e&&d},f.data(),c.data())):(f=d,g="toggle"),c.is("a")&&b.preventDefault(),h.call(f,g)}),a.jqModal={tip:function(){var b=a(".jqtip"),c=b[0]&&"show"||{mclass:"tip",animate:"shake",css:{top:100},lock:1,timeout:arguments[2]||1500};b[0]||(b=a('<div class="jqtip"></div>')),h.call(b.html('<i class="ico ico-'+arguments[1]+'"></i>'+arguments[0]),c,arguments[2]||1500)},alert:function(b){var c=a(".jqalert"),b=c[0]&&"show"||{head:"提示信息",css:{width:300},foot:'<button data-close="1" class="ok">确定</button>'};c[0]||(c=a('<div class="jqalert"></div>')),h.call(c.html('<i class="ico ico-info"></i>'+b),b)},lay:function(b){var c=b;a(".jqlay").length?("hide"!=b&&a(".jqlay").html(c),a(".jqlay").jqModal(b)):a('<div class="jqlay">'+c+"</div>").appendTo("body").jqModal()},confirm:function(b,c){a(".jqAlert").length?"show"==b||"hide"==b||"toggle"==b?a(".jqAlert").jqModal(b):(a(".jqAlert").data("jqModal").$content.html(c),a(".jqAlert").data("jqModal").show()):h.call(a('<div class="jqAlert">'+c+"</div>").appendTo("body"),{title:b,overlay:0})}}}(jQuery);